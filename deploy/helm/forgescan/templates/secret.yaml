apiVersion: v1
kind: Secret
metadata:
  name: {{ include "forgescan.fullname" . }}-secrets
  labels:
    {{- include "forgescan.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- if .Values.nvd.apiKey }}
  NVD_API_KEY: {{ .Values.nvd.apiKey | quote }}
  {{- end }}
---
{{- if or .Values.ingestion.tenable.enabled .Values.ingestion.qualys.enabled .Values.ingestion.rapid7.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "forgescan.fullname" . }}-vendor-secrets
  labels:
    {{- include "forgescan.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- if .Values.ingestion.tenable.enabled }}
  TENABLE_ACCESS_KEY: {{ .Values.ingestion.tenable.accessKey | quote }}
  TENABLE_SECRET_KEY: {{ .Values.ingestion.tenable.secretKey | quote }}
  {{- end }}
  {{- if .Values.ingestion.qualys.enabled }}
  QUALYS_USERNAME: {{ .Values.ingestion.qualys.username | quote }}
  QUALYS_PASSWORD: {{ .Values.ingestion.qualys.password | quote }}
  QUALYS_API_URL: {{ .Values.ingestion.qualys.apiUrl | quote }}
  {{- end }}
  {{- if .Values.ingestion.rapid7.enabled }}
  RAPID7_API_KEY: {{ .Values.ingestion.rapid7.apiKey | quote }}
  RAPID7_API_URL: {{ .Values.ingestion.rapid7.apiUrl | quote }}
  {{- end }}
{{- end }}
---
{{- if .Values.cloudScanner.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "forgescan.fullname" . }}-cloud-secrets
  labels:
    {{- include "forgescan.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- if and (not .Values.cloudScanner.aws.useIRSA) .Values.cloudScanner.aws.accessKeyId }}
  AWS_ACCESS_KEY_ID: {{ .Values.cloudScanner.aws.accessKeyId | quote }}
  AWS_SECRET_ACCESS_KEY: {{ .Values.cloudScanner.aws.secretAccessKey | quote }}
  {{- end }}
  {{- if .Values.cloudScanner.azure.enabled }}
  AZURE_TENANT_ID: {{ .Values.cloudScanner.azure.tenantId | quote }}
  AZURE_CLIENT_ID: {{ .Values.cloudScanner.azure.clientId | quote }}
  AZURE_CLIENT_SECRET: {{ .Values.cloudScanner.azure.clientSecret | quote }}
  {{- end }}
  {{- if .Values.cloudScanner.gcp.enabled }}
  GOOGLE_PROJECT_ID: {{ .Values.cloudScanner.gcp.projectId | quote }}
  {{- end }}
{{- end }}
