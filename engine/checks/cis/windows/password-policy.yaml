# CIS Benchmark - Windows Password Policy
# Applies to: CIS Microsoft Windows Server 2022, CIS Windows 11

checks:
  - id: CIS-WIN-PWD-001
    name: Ensure 'Enforce password history' is set to '24 or more password(s)'
    description: |
      This policy setting determines the number of renewed, unique passwords that
      have to be associated with a user account before an old password can be reused.
    severity: medium
    platform: windows
    compliance:
      - framework: CIS
        control: "1.1.1"
        benchmark: "CIS Microsoft Windows Server 2022"
    check:
      type: registry
      path: HKLM\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
      value_name: PasswordHistorySize
      expected:
        type: dword
        value: 24
    remediation: |
      Configure the following Group Policy setting:
      Computer Configuration\Policies\Windows Settings\Security Settings\
      Account Policies\Password Policy\Enforce password history: 24 or more

  - id: CIS-WIN-PWD-002
    name: Ensure 'Maximum password age' is set to '365 or fewer days, but not 0'
    description: |
      This policy setting defines how long a user can use their password before it
      expires. Values between 60 and 365 days are recommended.
    severity: medium
    platform: windows
    compliance:
      - framework: CIS
        control: "1.1.2"
        benchmark: "CIS Microsoft Windows Server 2022"
    check:
      type: registry
      path: HKLM\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
      value_name: MaximumPasswordAge
      expected:
        type: dword
        value: 365
    remediation: |
      Configure the following Group Policy setting:
      Computer Configuration\Policies\Windows Settings\Security Settings\
      Account Policies\Password Policy\Maximum password age: 365 days

  - id: CIS-WIN-PWD-003
    name: Ensure 'Minimum password age' is set to '1 or more day(s)'
    description: |
      This policy setting determines the number of days that you must use a password
      before you can change it. This prevents users from cycling through passwords.
    severity: low
    platform: windows
    compliance:
      - framework: CIS
        control: "1.1.3"
        benchmark: "CIS Microsoft Windows Server 2022"
    check:
      type: registry
      path: HKLM\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
      value_name: MinimumPasswordAge
      expected:
        type: dword
        value: 1
    remediation: |
      Configure the following Group Policy setting:
      Computer Configuration\Policies\Windows Settings\Security Settings\
      Account Policies\Password Policy\Minimum password age: 1 day

  - id: CIS-WIN-PWD-004
    name: Ensure 'Minimum password length' is set to '14 or more character(s)'
    description: |
      This policy setting determines the least number of characters that make up a
      password for a user account. Longer passwords are exponentially harder to crack.
    severity: medium
    platform: windows
    compliance:
      - framework: CIS
        control: "1.1.4"
        benchmark: "CIS Microsoft Windows Server 2022"
    check:
      type: command
      command: net
      args: ["accounts"]
      expected_output: "Minimum password length"
    remediation: |
      Configure the following Group Policy setting:
      Computer Configuration\Policies\Windows Settings\Security Settings\
      Account Policies\Password Policy\Minimum password length: 14 characters

  - id: CIS-WIN-PWD-005
    name: Ensure 'Password must meet complexity requirements' is set to 'Enabled'
    description: |
      This policy setting checks all new passwords to ensure they meet basic
      requirements for strong passwords: uppercase, lowercase, digits, symbols.
    severity: medium
    platform: windows
    compliance:
      - framework: CIS
        control: "1.1.5"
        benchmark: "CIS Microsoft Windows Server 2022"
    check:
      type: registry
      path: HKLM\SYSTEM\CurrentControlSet\Control\SAM
      value_name: PasswordComplexity
      expected:
        type: dword
        value: 1
    remediation: |
      Configure the following Group Policy setting:
      Computer Configuration\Policies\Windows Settings\Security Settings\
      Account Policies\Password Policy\Password must meet complexity requirements: Enabled

  - id: CIS-WIN-PWD-006
    name: Ensure 'Account lockout duration' is set to '15 or more minute(s)'
    description: |
      This policy setting determines the length of time that must pass before a
      locked account is unlocked and a user can try to log on again.
    severity: medium
    platform: windows
    compliance:
      - framework: CIS
        control: "1.2.1"
        benchmark: "CIS Microsoft Windows Server 2022"
    check:
      type: command
      command: net
      args: ["accounts"]
      expected_output: "Lockout duration"
    remediation: |
      Configure the following Group Policy setting:
      Computer Configuration\Policies\Windows Settings\Security Settings\
      Account Policies\Account Lockout Policy\Account lockout duration: 15 minutes

  - id: CIS-WIN-PWD-007
    name: Ensure 'Account lockout threshold' is set to '5 or fewer invalid logon attempt(s)'
    description: |
      This policy setting determines the number of failed logon attempts before
      the account is locked. Setting a low threshold helps prevent brute force attacks.
    severity: medium
    platform: windows
    compliance:
      - framework: CIS
        control: "1.2.2"
        benchmark: "CIS Microsoft Windows Server 2022"
    check:
      type: command
      command: net
      args: ["accounts"]
      expected_output: "Lockout threshold"
    remediation: |
      Configure the following Group Policy setting:
      Computer Configuration\Policies\Windows Settings\Security Settings\
      Account Policies\Account Lockout Policy\Account lockout threshold: 5 attempts
