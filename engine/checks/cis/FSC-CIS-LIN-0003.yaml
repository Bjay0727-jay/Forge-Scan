# ForgeScan Check Definition
# CIS Linux - Password Complexity

id: "FSC-CIS-LIN-0003"
name: "Insufficient Password Complexity Requirements"
description: |
  Password complexity requirements are not configured or are insufficient.
  Weak passwords can be easily guessed or cracked through brute-force attacks.
category: configuration
severity: medium

cwe_ids:
  - CWE-521

compliance:
  - framework: "CIS"
    benchmark: "CIS Ubuntu Linux 22.04 LTS"
    control: "5.4.1"
  - framework: "CIS"
    benchmark: "CIS RHEL 8"
    control: "5.4.1"
  - framework: "NIST-800-53"
    control: "IA-5"
  - framework: "PCI-DSS"
    control: "8.2.3"

detection:
  type: config-value
  mode: agent
  files:
    - path: "/etc/security/pwquality.conf"
      checks:
        - key: "minlen"
          expected_min: 14
          finding_if_less: "Minimum password length is less than 14"
        - key: "dcredit"
          expected: -1
          finding_if_not_match: "Password does not require digit"
        - key: "ucredit"
          expected: -1
          finding_if_not_match: "Password does not require uppercase"
        - key: "lcredit"
          expected: -1
          finding_if_not_match: "Password does not require lowercase"
        - key: "ocredit"
          expected: -1
          finding_if_not_match: "Password does not require special character"

remediation: |
  1. Install libpam-pwquality if not present:
     apt install libpam-pwquality

  2. Edit /etc/security/pwquality.conf:
     minlen = 14
     dcredit = -1
     ucredit = -1
     lcredit = -1
     ocredit = -1

  3. Ensure pam_pwquality is enabled in /etc/pam.d/common-password

references:
  - "https://www.cisecurity.org/benchmark/ubuntu_linux"
  - "https://man7.org/linux/man-pages/man5/pwquality.conf.5.html"

enabled_by_default: true
requires_agent: true
