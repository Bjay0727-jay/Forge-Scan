# ForgeScan Check Definition
# AWS Security Group - Unrestricted Access

id: "FSC-CLOUD-AWS-0002"
name: "AWS Security Group Allows Unrestricted Ingress"
description: |
  Security group allows unrestricted access (0.0.0.0/0) to sensitive ports.
  This exposes the resource to potential attacks from the internet.
category: cloud
severity: high

cwe_ids:
  - CWE-284
  - CWE-1188

compliance:
  - framework: "CIS-AWS"
    control: "5.2"
  - framework: "NIST-800-53"
    control: "SC-7"
  - framework: "PCI-DSS"
    control: "1.2"

detection:
  type: cloud-api
  provider: aws
  service: ec2
  checks:
    - api: "describe_security_groups"
      finding_if:
        ingress:
          cidr: "0.0.0.0/0"
          ports:
            - 22    # SSH
            - 3389  # RDP
            - 3306  # MySQL
            - 5432  # PostgreSQL
            - 27017 # MongoDB
            - 6379  # Redis
            - 445   # SMB
            - 1433  # MSSQL
      message: "Security group allows unrestricted access to sensitive port"

remediation: |
  1. Review all security groups with open access:
     aws ec2 describe-security-groups \
       --filters Name=ip-permission.cidr,Values=0.0.0.0/0

  2. Restrict access to specific IP ranges or security groups:
     aws ec2 revoke-security-group-ingress \
       --group-id $SG_ID \
       --protocol tcp \
       --port $PORT \
       --cidr 0.0.0.0/0

     aws ec2 authorize-security-group-ingress \
       --group-id $SG_ID \
       --protocol tcp \
       --port $PORT \
       --cidr $TRUSTED_CIDR

  3. Use VPN, bastion hosts, or AWS Systems Manager Session Manager
     for administrative access

references:
  - "https://docs.aws.amazon.com/vpc/latest/userguide/security-group-rules.html"
  - "https://www.cisecurity.org/benchmark/amazon_web_services"

enabled_by_default: true
