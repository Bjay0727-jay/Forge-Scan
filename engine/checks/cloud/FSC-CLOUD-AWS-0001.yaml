# ForgeScan Check Definition
# AWS S3 Public Access

id: "FSC-CLOUD-AWS-0001"
name: "AWS S3 Bucket Public Access"
description: |
  S3 bucket is configured to allow public access. This could expose
  sensitive data to unauthorized users on the internet.
category: cloud
severity: critical

cwe_ids:
  - CWE-284
  - CWE-732

compliance:
  - framework: "CIS-AWS"
    control: "2.1.5"
  - framework: "NIST-800-53"
    control: "AC-3"
  - framework: "PCI-DSS"
    control: "7.1"
  - framework: "SOC2"
    control: "CC6.1"

detection:
  type: cloud-api
  provider: aws
  service: s3
  checks:
    - api: "get_public_access_block"
      finding_if:
        - BlockPublicAcls: false
        - IgnorePublicAcls: false
        - BlockPublicPolicy: false
        - RestrictPublicBuckets: false
      message: "S3 bucket does not block public access"
    - api: "get_bucket_acl"
      finding_if:
        - grantee_uri: "http://acs.amazonaws.com/groups/global/AllUsers"
        - grantee_uri: "http://acs.amazonaws.com/groups/global/AuthenticatedUsers"
      message: "S3 bucket ACL grants public access"

remediation: |
  1. Enable S3 Block Public Access at account level:
     aws s3control put-public-access-block \
       --account-id $ACCOUNT_ID \
       --public-access-block-configuration \
       BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true

  2. Enable S3 Block Public Access at bucket level:
     aws s3api put-public-access-block \
       --bucket $BUCKET_NAME \
       --public-access-block-configuration \
       BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true

  3. Review and remove public ACLs and policies

references:
  - "https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html"
  - "https://www.cisecurity.org/benchmark/amazon_web_services"

enabled_by_default: true
