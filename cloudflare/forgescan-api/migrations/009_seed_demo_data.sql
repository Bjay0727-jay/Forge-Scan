-- ============================================================================
-- Migration 009: Seed Demo Data
-- Populates realistic vulnerability management data for dashboard demos.
-- All INSERT OR IGNORE so re-runs are safe (idempotent).
-- ============================================================================

-- ─── ASSETS (20) ────────────────────────────────────────────────────────────

INSERT OR IGNORE INTO assets (id, hostname, fqdn, ip_addresses, mac_addresses, os, os_version, asset_type, network_zone, risk_score, tags, attributes, first_seen, last_seen, created_at, updated_at) VALUES
  -- Web tier
  ('asset-web-01', 'web-01', 'web-01.forgescan.local', '["10.0.1.10"]', '["aa:bb:cc:01:01:01"]', 'Ubuntu', '22.04 LTS', 'server', 'dmz', 92, '["production","web-tier","critical"]', '{"env":"production","team":"platform"}', '2025-06-15T08:00:00Z', '2026-02-20T14:30:00Z', '2025-06-15T08:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-web-02', 'web-02', 'web-02.forgescan.local', '["10.0.1.11"]', '["aa:bb:cc:01:01:02"]', 'Ubuntu', '22.04 LTS', 'server', 'dmz', 78, '["production","web-tier"]', '{"env":"production","team":"platform"}', '2025-06-15T08:00:00Z', '2026-02-20T14:30:00Z', '2025-06-15T08:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-web-03', 'web-03', 'web-03.forgescan.local', '["10.0.1.12"]', '["aa:bb:cc:01:01:03"]', 'Amazon Linux', '2023', 'server', 'dmz', 65, '["production","web-tier"]', '{"env":"production","team":"platform"}', '2025-08-01T10:00:00Z', '2026-02-20T14:30:00Z', '2025-08-01T10:00:00Z', '2026-02-20T14:30:00Z'),

  -- API tier
  ('asset-api-01', 'api-01', 'api-01.forgescan.local', '["10.0.2.10"]', '["aa:bb:cc:02:01:01"]', 'Alpine Linux', '3.19', 'container', 'internal', 85, '["production","api-tier","critical"]', '{"env":"production","team":"backend","runtime":"node20"}', '2025-07-01T09:00:00Z', '2026-02-20T14:30:00Z', '2025-07-01T09:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-api-02', 'api-02', 'api-02.forgescan.local', '["10.0.2.11"]', '["aa:bb:cc:02:01:02"]', 'Alpine Linux', '3.19', 'container', 'internal', 72, '["production","api-tier"]', '{"env":"production","team":"backend","runtime":"node20"}', '2025-07-01T09:00:00Z', '2026-02-20T14:30:00Z', '2025-07-01T09:00:00Z', '2026-02-20T14:30:00Z'),

  -- Database tier
  ('asset-db-01', 'db-primary', 'db-primary.forgescan.local', '["10.0.3.10"]', '["aa:bb:cc:03:01:01"]', 'Ubuntu', '22.04 LTS', 'server', 'restricted', 95, '["production","database","critical","pci"]', '{"env":"production","team":"dba","engine":"postgres-16"}', '2025-06-01T07:00:00Z', '2026-02-20T14:30:00Z', '2025-06-01T07:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-db-02', 'db-replica', 'db-replica.forgescan.local', '["10.0.3.11"]', '["aa:bb:cc:03:01:02"]', 'Ubuntu', '22.04 LTS', 'server', 'restricted', 70, '["production","database"]', '{"env":"production","team":"dba","engine":"postgres-16"}', '2025-06-01T07:00:00Z', '2026-02-20T14:30:00Z', '2025-06-01T07:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-db-03', 'redis-01', 'redis-01.forgescan.local', '["10.0.3.20"]', '["aa:bb:cc:03:02:01"]', 'Ubuntu', '22.04 LTS', 'server', 'restricted', 55, '["production","cache"]', '{"env":"production","team":"dba","engine":"redis-7"}', '2025-09-10T11:00:00Z', '2026-02-20T14:30:00Z', '2025-09-10T11:00:00Z', '2026-02-20T14:30:00Z'),

  -- Infrastructure
  ('asset-lb-01', 'lb-01', 'lb-01.forgescan.local', '["10.0.0.5"]', '["aa:bb:cc:00:01:01"]', 'HAProxy', '2.8', 'network_device', 'dmz', 60, '["production","load-balancer"]', '{"env":"production","team":"infra"}', '2025-06-15T08:00:00Z', '2026-02-20T14:30:00Z', '2025-06-15T08:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-fw-01', 'fw-edge', 'fw-edge.forgescan.local', '["10.0.0.1"]', '["aa:bb:cc:00:00:01"]', 'pfSense', '2.7', 'network_device', 'edge', 45, '["production","firewall","critical"]', '{"env":"production","team":"security"}', '2025-06-01T07:00:00Z', '2026-02-20T14:30:00Z', '2025-06-01T07:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-vpn-01', 'vpn-01', 'vpn-01.forgescan.local', '["10.0.0.3"]', '["aa:bb:cc:00:00:03"]', 'OpenVPN', '2.6', 'network_device', 'edge', 50, '["production","vpn"]', '{"env":"production","team":"infra"}', '2025-07-20T12:00:00Z', '2026-02-20T14:30:00Z', '2025-07-20T12:00:00Z', '2026-02-20T14:30:00Z'),

  -- Cloud workloads
  ('asset-cloud-01', 'eks-node-01', 'eks-node-01.us-east-1.compute.internal', '["172.16.1.10"]', '[]', 'Amazon Linux', '2023', 'container', 'cloud-vpc', 80, '["production","kubernetes","aws"]', '{"env":"production","team":"devops","cluster":"forge-prod"}', '2025-10-01T06:00:00Z', '2026-02-20T14:30:00Z', '2025-10-01T06:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-cloud-02', 'eks-node-02', 'eks-node-02.us-east-1.compute.internal', '["172.16.1.11"]', '[]', 'Amazon Linux', '2023', 'container', 'cloud-vpc', 75, '["production","kubernetes","aws"]', '{"env":"production","team":"devops","cluster":"forge-prod"}', '2025-10-01T06:00:00Z', '2026-02-20T14:30:00Z', '2025-10-01T06:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-cloud-03', 's3-data-lake', NULL, '[]', '[]', 'AWS S3', NULL, 'cloud_resource', 'cloud-vpc', 88, '["production","storage","aws","pci"]', '{"env":"production","team":"data","bucket":"forge-data-lake"}', '2025-08-15T09:00:00Z', '2026-02-20T14:30:00Z', '2025-08-15T09:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-cloud-04', 'rds-analytics', 'forge-analytics.cluster-abc.us-east-1.rds.amazonaws.com', '["172.16.3.50"]', '[]', 'Aurora PostgreSQL', '15.4', 'cloud_resource', 'cloud-vpc', 82, '["production","database","aws"]', '{"env":"production","team":"data","engine":"aurora-pg"}', '2025-09-01T10:00:00Z', '2026-02-20T14:30:00Z', '2025-09-01T10:00:00Z', '2026-02-20T14:30:00Z'),

  -- Development & staging
  ('asset-dev-01', 'dev-app-01', 'dev-app-01.forgescan.local', '["10.0.10.10"]', '[]', 'Ubuntu', '24.04 LTS', 'server', 'dev', 35, '["development","non-prod"]', '{"env":"development","team":"engineering"}', '2025-11-01T08:00:00Z', '2026-02-20T14:30:00Z', '2025-11-01T08:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-staging-01', 'staging-web', 'staging-web.forgescan.local', '["10.0.5.10"]', '[]', 'Ubuntu', '22.04 LTS', 'server', 'staging', 42, '["staging","non-prod"]', '{"env":"staging","team":"qa"}', '2025-10-15T09:00:00Z', '2026-02-20T14:30:00Z', '2025-10-15T09:00:00Z', '2026-02-20T14:30:00Z'),

  -- IoT / specialty
  ('asset-iot-01', 'cam-lobby-01', 'cam-lobby-01.forgescan.local', '["10.0.8.100"]', '["dd:ee:ff:08:01:01"]', 'Linux', '4.14', 'iot', 'iot-vlan', 68, '["production","iot","physical-security"]', '{"env":"production","team":"facilities","model":"Axis M3065"}', '2025-12-01T14:00:00Z', '2026-02-20T14:30:00Z', '2025-12-01T14:00:00Z', '2026-02-20T14:30:00Z'),
  ('asset-iot-02', 'badge-reader-01', 'badge-reader-01.forgescan.local', '["10.0.8.200"]', '["dd:ee:ff:08:02:01"]', 'Embedded Linux', '5.10', 'iot', 'iot-vlan', 58, '["production","iot","physical-security"]', '{"env":"production","team":"facilities"}', '2025-12-01T14:00:00Z', '2026-02-20T14:30:00Z', '2025-12-01T14:00:00Z', '2026-02-20T14:30:00Z'),

  -- Workstation
  ('asset-ws-01', 'eng-laptop-042', NULL, '["10.0.20.42"]', '[]', 'macOS', '14.3', 'workstation', 'corporate', 25, '["corporate","engineering"]', '{"env":"corporate","team":"engineering","user":"jdoe"}', '2026-01-05T10:00:00Z', '2026-02-20T14:30:00Z', '2026-01-05T10:00:00Z', '2026-02-20T14:30:00Z');


-- ─── SCANS (8) ──────────────────────────────────────────────────────────────

INSERT OR IGNORE INTO scans (id, name, scan_type, targets, config, status, findings_count, assets_count, started_at, completed_at, created_at, updated_at) VALUES
  ('scan-demo-001', 'Weekly Network Scan — DMZ', 'network', '["10.0.1.0/24","10.0.0.0/24"]', '{"depth":"full","ports":"1-65535"}', 'completed', 18, 5, '2026-02-17T02:00:00Z', '2026-02-17T02:47:00Z', '2026-02-17T01:55:00Z', '2026-02-17T02:47:00Z'),
  ('scan-demo-002', 'API Security Assessment', 'web', '["api-01.forgescan.local","api-02.forgescan.local"]', '{"crawler":true,"auth":"bearer"}', 'completed', 12, 2, '2026-02-15T10:00:00Z', '2026-02-15T11:22:00Z', '2026-02-15T09:55:00Z', '2026-02-15T11:22:00Z'),
  ('scan-demo-003', 'Cloud Infrastructure Audit', 'cloud', '["arn:aws:*:us-east-1:123456789:*"]', '{"services":["ec2","s3","iam","rds"]}', 'completed', 14, 4, '2026-02-13T08:00:00Z', '2026-02-13T08:38:00Z', '2026-02-13T07:55:00Z', '2026-02-13T08:38:00Z'),
  ('scan-demo-004', 'Database Compliance Check', 'compliance', '["10.0.3.0/24"]', '{"framework":"pci-dss","controls":"all"}', 'completed', 8, 3, '2026-02-10T03:00:00Z', '2026-02-10T03:15:00Z', '2026-02-10T02:55:00Z', '2026-02-10T03:15:00Z'),
  ('scan-demo-005', 'Container Image Scan', 'container', '["forge-api:latest","forge-web:latest","forge-worker:latest"]', '{"registry":"ecr","scan_dependencies":true}', 'completed', 9, 3, '2026-02-08T14:00:00Z', '2026-02-08T14:12:00Z', '2026-02-08T13:55:00Z', '2026-02-08T14:12:00Z'),
  ('scan-demo-006', 'Full Infrastructure Scan — Q1', 'network', '["10.0.0.0/16"]', '{"depth":"full","ports":"top-1000","os_detection":true}', 'running', 6, 12, '2026-02-21T02:00:00Z', NULL, '2026-02-21T01:55:00Z', '2026-02-21T02:00:00Z'),
  ('scan-demo-007', 'IoT Device Assessment', 'network', '["10.0.8.0/24"]', '{"depth":"standard","ports":"common"}', 'pending', 0, 0, NULL, NULL, '2026-02-21T08:00:00Z', '2026-02-21T08:00:00Z'),
  ('scan-demo-008', 'Code Security Review', 'code', '["github.com/forge/forgescan-api"]', '{"languages":["typescript"],"sast":true}', 'completed', 5, 1, '2026-02-06T16:00:00Z', '2026-02-06T16:08:00Z', '2026-02-06T15:55:00Z', '2026-02-06T16:08:00Z');


-- ─── FINDINGS (52) ──────────────────────────────────────────────────────────
-- Realistic mix: 6 critical, 11 high, 16 medium, 12 low, 7 info
-- States: 38 open, 8 fixed, 4 acknowledged, 2 false_positive

-- CRITICAL findings (6)
INSERT OR IGNORE INTO findings (id, asset_id, scan_id, vendor, vendor_id, title, description, severity, state, cve_id, cvss_score, port, protocol, service, solution, references, frs_score, first_seen, last_seen, created_at, updated_at) VALUES
  ('f-crit-001', 'asset-db-01', 'scan-demo-001', 'tenable', 'PLUGIN-97001', 'PostgreSQL Remote Code Execution via crafted SQL', 'A remote attacker can execute arbitrary OS commands through specially crafted SQL statements exploiting a buffer overflow in the query parser.', 'critical', 'open', 'CVE-2025-29401', 9.8, 5432, 'tcp', 'postgresql', 'Upgrade PostgreSQL to 16.2 or later', '["https://nvd.nist.gov/vuln/detail/CVE-2025-29401"]', 9.8, '2026-02-17T02:15:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:15:00Z', '2026-02-20T14:30:00Z'),
  ('f-crit-002', 'asset-api-01', 'scan-demo-002', 'qualys', 'QID-370025', 'Authentication Bypass via JWT Algorithm Confusion', 'The API accepts JWTs signed with the HS256 algorithm using the RS256 public key, allowing an attacker to forge valid authentication tokens.', 'critical', 'open', 'CVE-2025-31052', 9.6, 443, 'tcp', 'https', 'Enforce RS256 algorithm validation; reject HS256 tokens when RS256 is configured', '["https://nvd.nist.gov/vuln/detail/CVE-2025-31052"]', 9.6, '2026-02-15T10:30:00Z', '2026-02-20T14:30:00Z', '2026-02-15T10:30:00Z', '2026-02-20T14:30:00Z'),
  ('f-crit-003', 'asset-cloud-03', 'scan-demo-003', 'rapid7', 'R7-2025-0184', 'S3 Bucket with Public Read Access — PCI Data', 'The S3 bucket forge-data-lake allows public read access via bucket ACL. This bucket contains PCI-scoped cardholder data.', 'critical', 'acknowledged', NULL, 9.1, NULL, NULL, 's3', 'Remove public ACL; enforce bucket policy with explicit deny for public access', '[]', 9.5, '2026-02-13T08:10:00Z', '2026-02-20T14:30:00Z', '2026-02-13T08:10:00Z', '2026-02-20T14:30:00Z'),
  ('f-crit-004', 'asset-web-01', 'scan-demo-001', 'tenable', 'PLUGIN-97015', 'Remote Code Execution in Apache Struts (S2-066)', 'The web server is running Apache Struts 6.3.0 which is vulnerable to a critical path traversal leading to remote code execution.', 'critical', 'open', 'CVE-2025-33891', 9.8, 8443, 'tcp', 'https', 'Upgrade Apache Struts to 6.3.1 or later', '["https://nvd.nist.gov/vuln/detail/CVE-2025-33891"]', 9.9, '2026-02-17T02:20:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:20:00Z', '2026-02-20T14:30:00Z'),
  ('f-crit-005', 'asset-cloud-01', 'scan-demo-003', 'rapid7', 'R7-2025-0192', 'IAM Role with AdministratorAccess Attached to EKS Node', 'The EKS node IAM role has the AWS-managed AdministratorAccess policy attached, granting full account access to any pod.', 'critical', 'open', NULL, 9.0, NULL, NULL, 'iam', 'Replace AdministratorAccess with least-privilege policies scoped to required services', '[]', 9.4, '2026-02-13T08:15:00Z', '2026-02-20T14:30:00Z', '2026-02-13T08:15:00Z', '2026-02-20T14:30:00Z'),
  ('f-crit-006', 'asset-vpn-01', 'scan-demo-001', 'tenable', 'PLUGIN-97030', 'OpenVPN Heap Overflow — Unauthenticated RCE', 'OpenVPN 2.6.0-2.6.5 contains a heap buffer overflow in the TLS handshake parser allowing unauthenticated remote code execution.', 'critical', 'open', 'CVE-2025-28910', 10.0, 1194, 'udp', 'openvpn', 'Upgrade OpenVPN to 2.6.6 or later immediately', '["https://nvd.nist.gov/vuln/detail/CVE-2025-28910"]', 10.0, '2026-02-17T02:12:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:12:00Z', '2026-02-20T14:30:00Z');

-- HIGH findings (11)
INSERT OR IGNORE INTO findings (id, asset_id, scan_id, vendor, vendor_id, title, description, severity, state, cve_id, cvss_score, port, protocol, service, solution, references, frs_score, first_seen, last_seen, created_at, updated_at) VALUES
  ('f-high-001', 'asset-web-01', 'scan-demo-002', 'qualys', 'QID-370041', 'Cross-Site Scripting (Stored) in User Profile', 'The user profile display_name field is rendered without sanitization, allowing persistent XSS when viewed by other users.', 'high', 'open', 'CVE-2025-30112', 7.6, 443, 'tcp', 'https', 'Sanitize all user input with DOMPurify before rendering; implement Content-Security-Policy', '["https://nvd.nist.gov/vuln/detail/CVE-2025-30112"]', 7.8, '2026-02-15T10:45:00Z', '2026-02-20T14:30:00Z', '2026-02-15T10:45:00Z', '2026-02-20T14:30:00Z'),
  ('f-high-002', 'asset-api-01', 'scan-demo-002', 'qualys', 'QID-370050', 'IDOR — Insecure Direct Object Reference in /api/users/:id', 'Any authenticated user can access other users profile data by enumerating the user ID parameter.', 'high', 'open', NULL, 7.5, 443, 'tcp', 'https', 'Implement authorization middleware to verify the requesting user owns the resource', '[]', 7.5, '2026-02-15T10:50:00Z', '2026-02-20T14:30:00Z', '2026-02-15T10:50:00Z', '2026-02-20T14:30:00Z'),
  ('f-high-003', 'asset-db-01', 'scan-demo-004', 'tenable', 'PLUGIN-97055', 'PostgreSQL TLS Certificate Expired', 'The PostgreSQL TLS certificate expired 12 days ago, meaning client connections may fall back to unencrypted mode.', 'high', 'fixed', NULL, 7.4, 5432, 'tcp', 'postgresql', 'Renew the TLS certificate and configure require-ssl in pg_hba.conf', '[]', 7.0, '2026-02-10T03:05:00Z', '2026-02-18T09:00:00Z', '2026-02-10T03:05:00Z', '2026-02-18T09:00:00Z'),
  ('f-high-004', 'asset-web-02', 'scan-demo-001', 'tenable', 'PLUGIN-97062', 'Nginx Version Disclosure & Known CVE', 'Nginx 1.24.0 is running with server tokens enabled and is affected by HTTP/2 rapid reset vulnerability.', 'high', 'open', 'CVE-2025-27390', 7.5, 443, 'tcp', 'https', 'Upgrade Nginx to 1.25.4+; add server_tokens off to config', '["https://nvd.nist.gov/vuln/detail/CVE-2025-27390"]', 7.2, '2026-02-17T02:25:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:25:00Z', '2026-02-20T14:30:00Z'),
  ('f-high-005', 'asset-cloud-04', 'scan-demo-003', 'rapid7', 'R7-2025-0198', 'RDS Instance Not Encrypted at Rest', 'Aurora PostgreSQL cluster forge-analytics does not have storage encryption enabled, violating PCI-DSS requirement 3.4.', 'high', 'open', NULL, 7.1, 5432, 'tcp', 'postgresql', 'Enable encryption at rest (requires snapshot, restore with encryption)', '[]', 7.5, '2026-02-13T08:20:00Z', '2026-02-20T14:30:00Z', '2026-02-13T08:20:00Z', '2026-02-20T14:30:00Z'),
  ('f-high-006', 'asset-web-03', 'scan-demo-005', 'generic', 'CVE-2025-32001', 'Prototype Pollution in lodash (Container Image)', 'Container image forge-web:latest includes lodash 4.17.20 which is vulnerable to prototype pollution via set/merge functions.', 'high', 'open', 'CVE-2025-32001', 7.3, NULL, NULL, NULL, 'Upgrade lodash to 4.17.22 or later in the container image', '["https://nvd.nist.gov/vuln/detail/CVE-2025-32001"]', 7.0, '2026-02-08T14:05:00Z', '2026-02-20T14:30:00Z', '2026-02-08T14:05:00Z', '2026-02-20T14:30:00Z'),
  ('f-high-007', 'asset-cloud-02', 'scan-demo-003', 'rapid7', 'R7-2025-0201', 'Security Group Allows SSH from 0.0.0.0/0', 'EKS node security group sg-0abc123 allows inbound SSH (port 22) from all IPv4 addresses.', 'high', 'fixed', NULL, 7.5, 22, 'tcp', 'ssh', 'Restrict SSH access to bastion host CIDR range only', '[]', 7.2, '2026-02-13T08:22:00Z', '2026-02-19T16:00:00Z', '2026-02-13T08:22:00Z', '2026-02-19T16:00:00Z'),
  ('f-high-008', 'asset-iot-01', 'scan-demo-001', 'tenable', 'PLUGIN-97080', 'IP Camera Default Credentials Active', 'Axis M3065 camera at 10.0.8.100 is accessible with default manufacturer credentials (admin/admin).', 'high', 'open', NULL, 8.1, 80, 'tcp', 'http', 'Change default credentials immediately; enable certificate-based auth', '[]', 8.5, '2026-02-17T02:35:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:35:00Z', '2026-02-20T14:30:00Z'),
  ('f-high-009', 'asset-api-02', 'scan-demo-002', 'qualys', 'QID-370065', 'Missing Rate Limiting on Authentication Endpoint', 'The /api/v1/auth/login endpoint has no rate limiting, allowing unlimited brute-force attempts.', 'high', 'open', NULL, 7.3, 443, 'tcp', 'https', 'Implement rate limiting (e.g., 5 attempts per minute per IP) with exponential backoff', '[]', 7.6, '2026-02-15T11:00:00Z', '2026-02-20T14:30:00Z', '2026-02-15T11:00:00Z', '2026-02-20T14:30:00Z'),
  ('f-high-010', 'asset-db-02', 'scan-demo-004', 'tenable', 'PLUGIN-97088', 'PostgreSQL Replica Allows Unencrypted Replication', 'The replication slot is configured with trust authentication, allowing any host on the network to replicate data.', 'high', 'fixed', NULL, 7.8, 5432, 'tcp', 'postgresql', 'Configure scram-sha-256 authentication for replication connections', '[]', 7.4, '2026-02-10T03:08:00Z', '2026-02-16T11:00:00Z', '2026-02-10T03:08:00Z', '2026-02-16T11:00:00Z'),
  ('f-high-011', 'asset-dev-01', 'scan-demo-008', 'generic', 'SAST-001', 'Hardcoded API Key in Source Code', 'Source file src/config/keys.ts contains a hardcoded AWS access key (AKIA...) committed to the repository.', 'high', 'fixed', NULL, 7.6, NULL, NULL, NULL, 'Rotate the exposed key immediately; use environment variables or AWS Secrets Manager', '[]', 8.0, '2026-02-06T16:03:00Z', '2026-02-07T10:00:00Z', '2026-02-06T16:03:00Z', '2026-02-07T10:00:00Z');

-- MEDIUM findings (16)
INSERT OR IGNORE INTO findings (id, asset_id, scan_id, vendor, vendor_id, title, description, severity, state, cve_id, cvss_score, port, protocol, service, solution, references, frs_score, first_seen, last_seen, created_at, updated_at) VALUES
  ('f-med-001', 'asset-web-01', 'scan-demo-001', 'tenable', 'PLUGIN-97100', 'Missing Content-Security-Policy Header', 'The web server does not set a Content-Security-Policy response header, increasing the risk of XSS attacks.', 'medium', 'open', NULL, 5.3, 443, 'tcp', 'https', 'Configure CSP header with strict-dynamic and nonce-based script loading', '[]', 5.0, '2026-02-17T02:16:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:16:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-002', 'asset-web-01', 'scan-demo-001', 'tenable', 'PLUGIN-97101', 'TLS 1.0 and 1.1 Supported', 'The server accepts TLS 1.0 and 1.1 connections which have known cryptographic weaknesses.', 'medium', 'open', NULL, 5.9, 443, 'tcp', 'https', 'Disable TLS 1.0 and 1.1; enforce TLS 1.2+ with strong cipher suites', '[]', 5.5, '2026-02-17T02:17:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:17:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-003', 'asset-web-02', 'scan-demo-001', 'tenable', 'PLUGIN-97102', 'Missing X-Frame-Options Header', 'No X-Frame-Options header is set, potentially allowing clickjacking attacks.', 'medium', 'open', NULL, 4.7, 443, 'tcp', 'https', 'Set X-Frame-Options: DENY or SAMEORIGIN', '[]', 4.5, '2026-02-17T02:18:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:18:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-004', 'asset-api-01', 'scan-demo-002', 'qualys', 'QID-370100', 'Verbose Error Messages Expose Stack Traces', 'The API returns full stack traces in 500 error responses, leaking internal implementation details.', 'medium', 'open', NULL, 5.3, 443, 'tcp', 'https', 'Configure production error handler to return generic error messages', '[]', 5.0, '2026-02-15T10:55:00Z', '2026-02-20T14:30:00Z', '2026-02-15T10:55:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-005', 'asset-api-02', 'scan-demo-002', 'qualys', 'QID-370105', 'CORS Misconfiguration — Wildcard Origin', 'Access-Control-Allow-Origin is set to * on authenticated endpoints, allowing any origin to make credentialed requests.', 'medium', 'open', NULL, 6.1, 443, 'tcp', 'https', 'Restrict CORS to specific trusted origins; remove wildcard for authenticated routes', '[]', 6.0, '2026-02-15T11:05:00Z', '2026-02-20T14:30:00Z', '2026-02-15T11:05:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-006', 'asset-cloud-01', 'scan-demo-003', 'rapid7', 'R7-2025-0210', 'CloudTrail Logging Disabled for S3 Data Events', 'S3 data event logging is not enabled in CloudTrail, creating a blind spot for data access auditing.', 'medium', 'open', NULL, 5.5, NULL, NULL, 's3', 'Enable S3 data event logging in CloudTrail for the forge-data-lake bucket', '[]', 5.8, '2026-02-13T08:25:00Z', '2026-02-20T14:30:00Z', '2026-02-13T08:25:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-007', 'asset-cloud-04', 'scan-demo-003', 'rapid7', 'R7-2025-0215', 'RDS Publicly Accessible Flag Enabled', 'Aurora cluster forge-analytics has PubliclyAccessible set to true, though security groups currently block access.', 'medium', 'open', NULL, 5.0, 5432, 'tcp', 'postgresql', 'Set PubliclyAccessible to false; access via VPC peering or PrivateLink only', '[]', 5.5, '2026-02-13T08:28:00Z', '2026-02-20T14:30:00Z', '2026-02-13T08:28:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-008', 'asset-db-01', 'scan-demo-004', 'tenable', 'PLUGIN-97110', 'PostgreSQL log_connections Not Enabled', 'Connection logging is disabled, making it impossible to audit who connects to the database.', 'medium', 'open', NULL, 4.3, 5432, 'tcp', 'postgresql', 'Set log_connections = on and log_disconnections = on in postgresql.conf', '[]', 4.5, '2026-02-10T03:10:00Z', '2026-02-20T14:30:00Z', '2026-02-10T03:10:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-009', 'asset-lb-01', 'scan-demo-001', 'tenable', 'PLUGIN-97115', 'HAProxy Stats Page Exposed Without Authentication', 'The HAProxy stats endpoint at /haproxy?stats is accessible without credentials on port 8404.', 'medium', 'open', NULL, 5.3, 8404, 'tcp', 'http', 'Add authentication to the stats endpoint or restrict access to management VLAN', '[]', 5.5, '2026-02-17T02:30:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:30:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-010', 'asset-iot-02', 'scan-demo-001', 'tenable', 'PLUGIN-97120', 'Badge Reader Firmware Outdated (18 months)', 'The badge reader is running firmware from August 2024 with 3 known CVEs patched in newer versions.', 'medium', 'open', NULL, 5.6, 443, 'tcp', 'https', 'Update badge reader firmware to latest version; schedule quarterly firmware reviews', '[]', 5.8, '2026-02-17T02:38:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:38:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-011', 'asset-web-03', 'scan-demo-005', 'generic', 'CVE-2025-31500', 'Express.js Query Parameter Pollution', 'Container image includes express 4.18.2 which is vulnerable to HPP via duplicate query parameters.', 'medium', 'open', 'CVE-2025-31500', 5.3, NULL, NULL, NULL, 'Upgrade express to 4.19.0+ or add hpp middleware', '["https://nvd.nist.gov/vuln/detail/CVE-2025-31500"]', 5.0, '2026-02-08T14:07:00Z', '2026-02-20T14:30:00Z', '2026-02-08T14:07:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-012', 'asset-staging-01', 'scan-demo-001', 'tenable', 'PLUGIN-97125', 'SSH Weak Key Exchange Algorithms', 'The SSH server accepts diffie-hellman-group14-sha1 which uses SHA-1 and is considered weak.', 'medium', 'false_positive', NULL, 4.3, 22, 'tcp', 'ssh', 'Remove sha1-based KEX algorithms from sshd_config', '[]', 4.0, '2026-02-17T02:40:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:40:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-013', 'asset-cloud-02', 'scan-demo-003', 'rapid7', 'R7-2025-0220', 'EKS Pod Security Standards Not Enforced', 'The EKS cluster forge-prod does not enforce Pod Security Standards, allowing privileged containers.', 'medium', 'open', NULL, 5.5, NULL, NULL, 'kubernetes', 'Enable Pod Security Admission in enforce mode with baseline profile', '[]', 5.8, '2026-02-13T08:30:00Z', '2026-02-20T14:30:00Z', '2026-02-13T08:30:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-014', 'asset-fw-01', 'scan-demo-001', 'tenable', 'PLUGIN-97130', 'Firewall Admin Interface on Public Interface', 'pfSense admin panel (port 8443) is reachable from the WAN interface, restricted only by IP allowlist.', 'medium', 'acknowledged', NULL, 5.9, 8443, 'tcp', 'https', 'Move admin interface to a dedicated management VLAN; disable WAN access', '[]', 6.0, '2026-02-17T02:10:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:10:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-015', 'asset-db-03', 'scan-demo-004', 'tenable', 'PLUGIN-97135', 'Redis Running Without Authentication', 'Redis instance on port 6379 accepts connections without a password from the restricted network zone.', 'medium', 'open', NULL, 6.5, 6379, 'tcp', 'redis', 'Set requirepass in redis.conf; configure ACLs for application users', '[]', 6.5, '2026-02-10T03:12:00Z', '2026-02-20T14:30:00Z', '2026-02-10T03:12:00Z', '2026-02-20T14:30:00Z'),
  ('f-med-016', 'asset-dev-01', 'scan-demo-008', 'generic', 'SAST-005', 'SQL Concatenation Instead of Parameterized Queries', 'Two endpoints build SQL queries using string concatenation with user input instead of parameterized queries.', 'medium', 'fixed', NULL, 6.3, NULL, NULL, NULL, 'Replace string concatenation with parameterized queries using prepared statements', '[]', 6.5, '2026-02-06T16:05:00Z', '2026-02-08T14:00:00Z', '2026-02-06T16:05:00Z', '2026-02-08T14:00:00Z');

-- LOW findings (12)
INSERT OR IGNORE INTO findings (id, asset_id, scan_id, vendor, vendor_id, title, description, severity, state, cve_id, cvss_score, port, protocol, service, solution, references, frs_score, first_seen, last_seen, created_at, updated_at) VALUES
  ('f-low-001', 'asset-web-01', 'scan-demo-001', 'tenable', 'PLUGIN-97200', 'HTTP Strict-Transport-Security max-age Too Short', 'HSTS header max-age is set to 86400 (1 day); recommended minimum is 31536000 (1 year).', 'low', 'open', NULL, 3.1, 443, 'tcp', 'https', 'Set HSTS max-age to at least 31536000 and include includeSubDomains', '[]', 3.0, '2026-02-17T02:19:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:19:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-002', 'asset-web-01', 'scan-demo-001', 'tenable', 'PLUGIN-97201', 'Cookie Without SameSite Attribute', 'Session cookie does not set the SameSite attribute, defaulting to Lax in modern browsers.', 'low', 'open', NULL, 3.1, 443, 'tcp', 'https', 'Set SameSite=Strict on session cookies', '[]', 3.0, '2026-02-17T02:20:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:20:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-003', 'asset-web-02', 'scan-demo-001', 'tenable', 'PLUGIN-97202', 'X-Content-Type-Options Header Missing', 'Response does not include X-Content-Type-Options: nosniff header.', 'low', 'open', NULL, 3.1, 443, 'tcp', 'https', 'Add X-Content-Type-Options: nosniff to all responses', '[]', 2.8, '2026-02-17T02:21:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:21:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-004', 'asset-api-01', 'scan-demo-002', 'qualys', 'QID-370200', 'API Versioning Not Enforced', 'API accepts requests without version prefix, potentially routing to unintended handlers.', 'low', 'open', NULL, 3.1, 443, 'tcp', 'https', 'Enforce /api/v1/ prefix on all routes; return 404 for unversioned paths', '[]', 3.0, '2026-02-15T11:10:00Z', '2026-02-20T14:30:00Z', '2026-02-15T11:10:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-005', 'asset-db-01', 'scan-demo-004', 'tenable', 'PLUGIN-97210', 'PostgreSQL Statement Timeout Not Configured', 'No statement_timeout is set, allowing queries to run indefinitely.', 'low', 'open', NULL, 3.7, 5432, 'tcp', 'postgresql', 'Set statement_timeout = 30000 in postgresql.conf', '[]', 3.5, '2026-02-10T03:14:00Z', '2026-02-20T14:30:00Z', '2026-02-10T03:14:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-006', 'asset-cloud-01', 'scan-demo-003', 'rapid7', 'R7-2025-0230', 'EC2 Instance Metadata v1 Enabled', 'IMDSv1 is still enabled on the EKS node, making it susceptible to SSRF-based credential theft.', 'low', 'acknowledged', NULL, 3.3, NULL, NULL, 'ec2', 'Enforce IMDSv2 by setting HttpTokens to required', '[]', 4.0, '2026-02-13T08:32:00Z', '2026-02-20T14:30:00Z', '2026-02-13T08:32:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-007', 'asset-fw-01', 'scan-demo-001', 'tenable', 'PLUGIN-97215', 'SNMP v2c Community String Default', 'pfSense SNMP uses default community string "public" for read access.', 'low', 'open', NULL, 3.5, 161, 'udp', 'snmp', 'Change SNMP community string or upgrade to SNMPv3 with authentication', '[]', 3.5, '2026-02-17T02:11:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:11:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-008', 'asset-web-03', 'scan-demo-005', 'generic', 'DEP-001', 'Node.js Minor Version Behind Latest', 'Container runs Node.js 20.10.0; latest is 20.11.1 with minor security patches.', 'low', 'open', NULL, 2.5, NULL, NULL, NULL, 'Update base image to node:20.11.1-alpine', '[]', 2.5, '2026-02-08T14:09:00Z', '2026-02-20T14:30:00Z', '2026-02-08T14:09:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-009', 'asset-staging-01', 'scan-demo-001', 'tenable', 'PLUGIN-97220', 'DNS Zone Transfer Allowed', 'The DNS server allows zone transfers (AXFR) from any source.', 'low', 'false_positive', NULL, 3.7, 53, 'tcp', 'dns', 'Restrict zone transfers to authorized secondary DNS servers', '[]', 3.5, '2026-02-17T02:42:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:42:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-010', 'asset-api-02', 'scan-demo-002', 'qualys', 'QID-370210', 'HTTP OPTIONS Method Enabled', 'The API responds to OPTIONS requests with a full list of allowed methods on all endpoints.', 'low', 'open', NULL, 2.6, 443, 'tcp', 'https', 'Restrict OPTIONS responses to only CORS-required endpoints', '[]', 2.5, '2026-02-15T11:15:00Z', '2026-02-20T14:30:00Z', '2026-02-15T11:15:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-011', 'asset-cloud-03', 'scan-demo-003', 'rapid7', 'R7-2025-0235', 'S3 Bucket Versioning Not Enabled', 'The forge-data-lake bucket does not have versioning enabled, preventing recovery from accidental deletion.', 'low', 'open', NULL, 3.3, NULL, NULL, 's3', 'Enable S3 bucket versioning with lifecycle rules for version expiration', '[]', 3.0, '2026-02-13T08:35:00Z', '2026-02-20T14:30:00Z', '2026-02-13T08:35:00Z', '2026-02-20T14:30:00Z'),
  ('f-low-012', 'asset-ws-01', 'scan-demo-001', 'tenable', 'PLUGIN-97225', 'macOS FileVault Encryption Status Unknown', 'Unable to verify FileVault encryption status on the workstation via remote scan.', 'low', 'open', NULL, 2.0, NULL, NULL, NULL, 'Verify FileVault is enabled via MDM; enforce encryption policy', '[]', 2.0, '2026-02-17T02:45:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:45:00Z', '2026-02-20T14:30:00Z');

-- INFO findings (7)
INSERT OR IGNORE INTO findings (id, asset_id, scan_id, vendor, vendor_id, title, description, severity, state, cve_id, cvss_score, port, protocol, service, solution, references, frs_score, first_seen, last_seen, created_at, updated_at) VALUES
  ('f-info-001', 'asset-web-01', 'scan-demo-001', 'tenable', 'PLUGIN-97300', 'Web Server Detected — Nginx 1.25.4', 'Nginx web server version 1.25.4 detected on port 443.', 'info', 'open', NULL, 0.0, 443, 'tcp', 'https', 'No action required — informational only', '[]', 0.0, '2026-02-17T02:15:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:15:00Z', '2026-02-20T14:30:00Z'),
  ('f-info-002', 'asset-db-01', 'scan-demo-001', 'tenable', 'PLUGIN-97301', 'PostgreSQL Version 16.1 Detected', 'PostgreSQL server version 16.1 detected on port 5432.', 'info', 'open', NULL, 0.0, 5432, 'tcp', 'postgresql', 'No action required — informational only', '[]', 0.0, '2026-02-17T02:15:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:15:00Z', '2026-02-20T14:30:00Z'),
  ('f-info-003', 'asset-lb-01', 'scan-demo-001', 'tenable', 'PLUGIN-97302', 'HAProxy Version 2.8 Detected', 'HAProxy load balancer version 2.8 detected.', 'info', 'open', NULL, 0.0, 80, 'tcp', 'http', 'No action required — informational only', '[]', 0.0, '2026-02-17T02:15:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:15:00Z', '2026-02-20T14:30:00Z'),
  ('f-info-004', 'asset-fw-01', 'scan-demo-001', 'tenable', 'PLUGIN-97303', 'pfSense 2.7 Detected', 'pfSense firewall version 2.7.0 detected on the edge device.', 'info', 'open', NULL, 0.0, 443, 'tcp', 'https', 'No action required — informational only', '[]', 0.0, '2026-02-17T02:10:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:10:00Z', '2026-02-20T14:30:00Z'),
  ('f-info-005', 'asset-cloud-01', 'scan-demo-003', 'rapid7', 'R7-2025-0250', 'EKS Cluster Version 1.28 Detected', 'Amazon EKS cluster forge-prod running Kubernetes version 1.28.', 'info', 'open', NULL, 0.0, NULL, NULL, 'kubernetes', 'No action required — informational only', '[]', 0.0, '2026-02-13T08:05:00Z', '2026-02-20T14:30:00Z', '2026-02-13T08:05:00Z', '2026-02-20T14:30:00Z'),
  ('f-info-006', 'asset-api-01', 'scan-demo-002', 'qualys', 'QID-370300', 'API Framework Detected — Hono v4', 'The API framework Hono v4 is detected via the X-Powered-By header.', 'info', 'open', NULL, 0.0, 443, 'tcp', 'https', 'Remove X-Powered-By header in production to reduce fingerprinting', '[]', 0.0, '2026-02-15T10:15:00Z', '2026-02-20T14:30:00Z', '2026-02-15T10:15:00Z', '2026-02-20T14:30:00Z'),
  ('f-info-007', 'asset-vpn-01', 'scan-demo-001', 'tenable', 'PLUGIN-97305', 'OpenVPN 2.6.5 Detected on UDP 1194', 'OpenVPN server version 2.6.5 detected on UDP port 1194.', 'info', 'open', NULL, 0.0, 1194, 'udp', 'openvpn', 'No action required — informational only', '[]', 0.0, '2026-02-17T02:12:00Z', '2026-02-20T14:30:00Z', '2026-02-17T02:12:00Z', '2026-02-20T14:30:00Z');


-- ─── COMPLIANCE FRAMEWORKS (2) + CONTROLS + MAPPINGS ────────────────────────

INSERT OR IGNORE INTO compliance_frameworks (id, name, short_name, version, description, controls_count, is_active) VALUES
  ('fw-nist', 'NIST SP 800-53', 'NIST-800-53', 'Rev 5', 'Security and Privacy Controls for Information Systems and Organizations', 20, 1),
  ('fw-pci', 'PCI DSS', 'PCI-DSS', 'v4.0', 'Payment Card Industry Data Security Standard', 12, 1);

-- NIST 800-53 Controls (20 sample)
INSERT OR IGNORE INTO compliance_controls (id, framework_id, control_id, control_name, description, family) VALUES
  ('ctrl-nist-ac01', 'fw-nist', 'AC-1', 'Access Control Policy', 'Develop, document, and disseminate access control policy', 'Access Control'),
  ('ctrl-nist-ac02', 'fw-nist', 'AC-2', 'Account Management', 'Manage system accounts including establishing, activating, and reviewing', 'Access Control'),
  ('ctrl-nist-ac03', 'fw-nist', 'AC-3', 'Access Enforcement', 'Enforce approved authorizations for logical access', 'Access Control'),
  ('ctrl-nist-ac06', 'fw-nist', 'AC-6', 'Least Privilege', 'Employ the principle of least privilege', 'Access Control'),
  ('ctrl-nist-au02', 'fw-nist', 'AU-2', 'Audit Events', 'Identify events that the system is capable of auditing', 'Audit and Accountability'),
  ('ctrl-nist-au03', 'fw-nist', 'AU-3', 'Content of Audit Records', 'Audit records contain sufficient information', 'Audit and Accountability'),
  ('ctrl-nist-au06', 'fw-nist', 'AU-6', 'Audit Review and Analysis', 'Review and analyze audit records for indications of activity', 'Audit and Accountability'),
  ('ctrl-nist-cm02', 'fw-nist', 'CM-2', 'Baseline Configuration', 'Develop and maintain baseline configurations', 'Configuration Management'),
  ('ctrl-nist-cm06', 'fw-nist', 'CM-6', 'Configuration Settings', 'Establish and document configuration settings', 'Configuration Management'),
  ('ctrl-nist-cm07', 'fw-nist', 'CM-7', 'Least Functionality', 'Configure the system to provide only essential capabilities', 'Configuration Management'),
  ('ctrl-nist-ia02', 'fw-nist', 'IA-2', 'Identification and Authentication', 'Uniquely identify and authenticate organizational users', 'Identification and Authentication'),
  ('ctrl-nist-ia05', 'fw-nist', 'IA-5', 'Authenticator Management', 'Manage system authenticators', 'Identification and Authentication'),
  ('ctrl-nist-sc07', 'fw-nist', 'SC-7', 'Boundary Protection', 'Monitor and control communications at external boundaries', 'System and Communications Protection'),
  ('ctrl-nist-sc08', 'fw-nist', 'SC-8', 'Transmission Confidentiality', 'Protect the confidentiality of transmitted information', 'System and Communications Protection'),
  ('ctrl-nist-sc12', 'fw-nist', 'SC-12', 'Cryptographic Key Management', 'Establish and manage cryptographic keys', 'System and Communications Protection'),
  ('ctrl-nist-sc28', 'fw-nist', 'SC-28', 'Protection of Information at Rest', 'Protect the confidentiality of information at rest', 'System and Communications Protection'),
  ('ctrl-nist-si02', 'fw-nist', 'SI-2', 'Flaw Remediation', 'Identify, report, and correct system flaws', 'System and Information Integrity'),
  ('ctrl-nist-si03', 'fw-nist', 'SI-3', 'Malicious Code Protection', 'Implement malicious code protection mechanisms', 'System and Information Integrity'),
  ('ctrl-nist-si05', 'fw-nist', 'SI-5', 'Security Alerts and Advisories', 'Receive and disseminate security alerts and advisories', 'System and Information Integrity'),
  ('ctrl-nist-si10', 'fw-nist', 'SI-10', 'Information Input Validation', 'Check the validity of information inputs', 'System and Information Integrity');

-- PCI DSS Controls (12 sample)
INSERT OR IGNORE INTO compliance_controls (id, framework_id, control_id, control_name, description, family) VALUES
  ('ctrl-pci-01', 'fw-pci', '1.1', 'Install and Maintain Network Security Controls', 'Network security controls are defined and understood', 'Network Security'),
  ('ctrl-pci-02', 'fw-pci', '2.1', 'Secure Default Configurations', 'Apply secure configurations to all system components', 'Secure Configuration'),
  ('ctrl-pci-03', 'fw-pci', '3.4', 'Protect Stored Account Data', 'Render PAN unreadable anywhere it is stored using cryptography', 'Data Protection'),
  ('ctrl-pci-04', 'fw-pci', '4.1', 'Protect Cardholder Data in Transit', 'Strong cryptography protects cardholder data during transmission', 'Encryption'),
  ('ctrl-pci-05', 'fw-pci', '5.2', 'Malware Prevention', 'Malicious software is prevented or detected and addressed', 'Malware Protection'),
  ('ctrl-pci-06', 'fw-pci', '6.2', 'Secure Software Development', 'Bespoke and custom software is developed securely', 'Secure Development'),
  ('ctrl-pci-07', 'fw-pci', '7.1', 'Restrict Access by Business Need', 'Access to system components is limited to necessary individuals', 'Access Control'),
  ('ctrl-pci-08', 'fw-pci', '8.3', 'Strong Authentication', 'Strong authentication for users and administrators is established', 'Authentication'),
  ('ctrl-pci-09', 'fw-pci', '9.4', 'Physical Media Protection', 'Media with cardholder data is securely stored and destroyed', 'Physical Security'),
  ('ctrl-pci-10', 'fw-pci', '10.2', 'Audit Log Implementation', 'Audit logs are implemented to support detection of anomalies', 'Logging and Monitoring'),
  ('ctrl-pci-11', 'fw-pci', '11.3', 'Vulnerability Scanning', 'External and internal vulnerabilities are regularly identified', 'Vulnerability Management'),
  ('ctrl-pci-12', 'fw-pci', '12.1', 'Information Security Policy', 'A comprehensive information security policy is established', 'Security Policy');

-- Compliance Mappings (link findings to controls)
INSERT OR IGNORE INTO compliance_mappings (id, finding_id, framework_id, control_id, status, evidence, assessed_at) VALUES
  ('map-001', 'f-crit-001', 'fw-nist', 'SI-2', 'non_compliant', 'PostgreSQL RCE vulnerability unpatched — flaw remediation overdue', '2026-02-17T03:00:00Z'),
  ('map-002', 'f-crit-001', 'fw-nist', 'SI-10', 'non_compliant', 'SQL parser buffer overflow indicates insufficient input validation', '2026-02-17T03:00:00Z'),
  ('map-003', 'f-crit-002', 'fw-nist', 'IA-2', 'non_compliant', 'JWT algorithm confusion allows authentication bypass', '2026-02-15T12:00:00Z'),
  ('map-004', 'f-crit-002', 'fw-nist', 'SC-12', 'non_compliant', 'Cryptographic key management failure in JWT validation', '2026-02-15T12:00:00Z'),
  ('map-005', 'f-crit-003', 'fw-pci', '3.4', 'non_compliant', 'S3 bucket with PCI data is publicly accessible', '2026-02-13T09:00:00Z'),
  ('map-006', 'f-crit-005', 'fw-nist', 'AC-6', 'non_compliant', 'EKS node has AdministratorAccess — violates least privilege', '2026-02-13T09:00:00Z'),
  ('map-007', 'f-high-005', 'fw-pci', '3.4', 'non_compliant', 'RDS cluster not encrypted at rest — PCI 3.4 violation', '2026-02-13T09:00:00Z'),
  ('map-008', 'f-high-005', 'fw-nist', 'SC-28', 'non_compliant', 'Information at rest is not protected via encryption', '2026-02-13T09:00:00Z'),
  ('map-009', 'f-med-002', 'fw-nist', 'SC-8', 'non_compliant', 'TLS 1.0/1.1 undermines transmission confidentiality', '2026-02-17T03:00:00Z'),
  ('map-010', 'f-med-002', 'fw-pci', '4.1', 'non_compliant', 'Weak TLS versions accepted — PCI 4.1 violation', '2026-02-17T03:00:00Z'),
  ('map-011', 'f-med-008', 'fw-nist', 'AU-3', 'non_compliant', 'Database connection logging disabled — insufficient audit records', '2026-02-10T04:00:00Z'),
  ('map-012', 'f-med-008', 'fw-pci', '10.2', 'non_compliant', 'Connection logging disabled — PCI 10.2 audit requirement unmet', '2026-02-10T04:00:00Z'),
  ('map-013', 'f-high-003', 'fw-nist', 'SC-8', 'compliant', 'TLS certificate renewed and require-ssl enforced', '2026-02-18T10:00:00Z'),
  ('map-014', 'f-high-003', 'fw-pci', '4.1', 'compliant', 'Database encryption in transit restored after certificate renewal', '2026-02-18T10:00:00Z'),
  ('map-015', 'f-med-015', 'fw-nist', 'IA-5', 'non_compliant', 'Redis accepts unauthenticated connections — authenticator management failure', '2026-02-10T04:00:00Z'),
  ('map-016', 'f-high-008', 'fw-nist', 'IA-5', 'non_compliant', 'IoT camera using default credentials', '2026-02-17T03:00:00Z'),
  ('map-017', 'f-high-009', 'fw-nist', 'AC-3', 'non_compliant', 'No rate limiting on auth endpoint — access enforcement gap', '2026-02-15T12:00:00Z'),
  ('map-018', 'f-high-009', 'fw-pci', '8.3', 'non_compliant', 'Unlimited login attempts — strong authentication requirement unmet', '2026-02-15T12:00:00Z');


-- ─── REDOPS CAMPAIGN (1 completed demo) ─────────────────────────────────────

INSERT OR IGNORE INTO redops_campaigns (id, name, description, status, campaign_type, target_scope, exclusions, agent_categories, max_concurrent_agents, exploitation_level, risk_threshold, auto_poam, compliance_mapping, total_agents, active_agents, completed_agents, failed_agents, findings_count, critical_count, high_count, medium_count, low_count, info_count, exploitable_count, started_at, completed_at, duration_seconds, created_at, updated_at) VALUES
  ('campaign-demo-001', 'Q1 2026 Penetration Test — Production', 'Comprehensive automated pen test of production web, API, and cloud infrastructure for Q1 2026 compliance cycle.', 'completed', 'full', '["10.0.1.0/24","10.0.2.0/24","10.0.3.0/24"]', '["10.0.10.0/24"]', '["web","api","network","identity"]', 6, 'safe', 'critical', 1, 1, 8, 0, 7, 1, 6, 2, 3, 1, 0, 0, 4, '2026-02-12T02:00:00Z', '2026-02-12T03:47:00Z', 6420, '2026-02-11T18:00:00Z', '2026-02-12T03:47:00Z');

-- RedOps agents for campaign
INSERT OR IGNORE INTO redops_agents (id, campaign_id, agent_type, agent_category, status, target, tests_planned, tests_completed, tests_passed, tests_failed, findings_count, exploitable_count, started_at, completed_at, duration_seconds) VALUES
  ('ragent-001', 'campaign-demo-001', 'web_injection', 'web', 'completed', '10.0.1.0/24', 45, 45, 43, 2, 2, 1, '2026-02-12T02:00:00Z', '2026-02-12T02:38:00Z', 2280),
  ('ragent-002', 'campaign-demo-001', 'web_xss', 'web', 'completed', '10.0.1.0/24', 38, 38, 37, 1, 1, 0, '2026-02-12T02:00:00Z', '2026-02-12T02:25:00Z', 1500),
  ('ragent-003', 'campaign-demo-001', 'api_auth_bypass', 'api', 'completed', '10.0.2.0/24', 28, 28, 26, 2, 2, 1, '2026-02-12T02:05:00Z', '2026-02-12T02:42:00Z', 2220),
  ('ragent-004', 'campaign-demo-001', 'api_bola', 'api', 'completed', '10.0.2.0/24', 24, 24, 23, 1, 1, 1, '2026-02-12T02:05:00Z', '2026-02-12T02:35:00Z', 1800),
  ('ragent-005', 'campaign-demo-001', 'net_portscan', 'network', 'completed', '10.0.0.0/22', 0, 0, 0, 0, 0, 0, '2026-02-12T02:00:00Z', '2026-02-12T02:15:00Z', 900),
  ('ragent-006', 'campaign-demo-001', 'net_service_enum', 'network', 'completed', '10.0.0.0/22', 0, 0, 0, 0, 0, 0, '2026-02-12T02:16:00Z', '2026-02-12T02:45:00Z', 1740),
  ('ragent-007', 'campaign-demo-001', 'id_credential', 'identity', 'completed', '10.0.0.0/22', 40, 40, 39, 1, 1, 1, '2026-02-12T02:45:00Z', '2026-02-12T03:30:00Z', 2700),
  ('ragent-008', 'campaign-demo-001', 'id_session', 'identity', 'failed', '10.0.0.0/22', 22, 8, 8, 0, 0, 0, '2026-02-12T02:45:00Z', '2026-02-12T03:02:00Z', 1020);

-- RedOps findings
INSERT OR IGNORE INTO redops_findings (id, campaign_id, agent_id, title, description, severity, exploitable, exploitation_proof, attack_vector, cwe_id, mitre_technique, remediation, remediation_effort, nist_controls, status) VALUES
  ('rf-001', 'campaign-demo-001', 'ragent-001', 'SQL Injection in Search Parameter', 'The /api/v1/assets?search= parameter is vulnerable to time-based blind SQL injection via SQLite-specific payloads.', 'critical', 1, 'Successfully extracted table names via time-based injection: CASE WHEN (SELECT count(*) FROM sqlite_master)>0 THEN randomblob(100000000) ELSE 0 END', 'GET /api/v1/assets?search='' OR CASE WHEN...', 'CWE-89', 'T1190', 'Use parameterized queries for all search parameters', 'quick_fix', '["SI-10","SC-18"]', 'confirmed'),
  ('rf-002', 'campaign-demo-001', 'ragent-001', 'NoSQL Injection in Filter Endpoint', 'The findings filter accepts operator-style JSON that is passed unsanitized to the query builder.', 'high', 1, 'Confirmed: able to extract finding count for any severity by injecting $gt operator', 'POST /api/v1/findings/filter body: {"severity":{"$gt":"info"}}', 'CWE-943', 'T1190', 'Validate and whitelist all filter operators; use strict schemas', 'moderate', '["SI-10"]', 'confirmed'),
  ('rf-003', 'campaign-demo-001', 'ragent-002', 'Reflected XSS in Error Page', 'The 404 error page reflects the requested URL path without encoding, enabling JavaScript execution.', 'high', 0, NULL, 'GET /api/<script>alert(1)</script>', 'CWE-79', 'T1059.007', 'Encode all user-controlled data in error responses', 'quick_fix', '["SI-10"]', 'open'),
  ('rf-004', 'campaign-demo-001', 'ragent-003', 'JWT Algorithm Confusion', 'API accepts HS256-signed tokens when configured for RS256, allowing forged tokens using the public key.', 'critical', 1, 'Forged admin JWT using RS256 public key with HS256 algorithm — full admin access obtained', 'Authorization: Bearer <forged-token>', 'CWE-327', 'T1078', 'Explicitly verify algorithm in JWT validation; reject unexpected algorithms', 'quick_fix', '["IA-2","SC-12"]', 'confirmed'),
  ('rf-005', 'campaign-demo-001', 'ragent-004', 'BOLA — User Can Access Other Users Scans', 'Authenticated user can view, modify, and delete scans belonging to other users by changing the scan ID.', 'high', 1, 'User A successfully deleted User B scan by calling DELETE /api/v1/scans/user-b-scan-id', 'DELETE /api/v1/scans/{other-user-scan-id}', 'CWE-639', 'T1078', 'Implement ownership validation middleware; verify requesting user owns the resource', 'moderate', '["AC-3","AC-6"]', 'confirmed'),
  ('rf-006', 'campaign-demo-001', 'ragent-007', 'Default Admin Credentials Active', 'The default admin account (admin@forgescan.local / ForgeAdmin2024!) is still active and has full administrator privileges.', 'critical', 1, 'Successfully authenticated as admin using default credentials and accessed all API endpoints', 'POST /api/v1/auth/login {"email":"admin@forgescan.local","password":"ForgeAdmin2024!"}', 'CWE-798', 'T1078.001', 'Disable or change default admin credentials; enforce password change on first login', 'quick_fix', '["IA-5","AC-2"]', 'confirmed');


-- ─── FIXED FINDINGS: Set fixed_at for MTTR & remediation trend calculations ─

UPDATE findings SET fixed_at = '2026-02-18T09:00:00Z' WHERE id = 'f-high-003';
UPDATE findings SET fixed_at = '2026-02-19T16:00:00Z' WHERE id = 'f-high-007';
UPDATE findings SET fixed_at = '2026-02-16T11:00:00Z' WHERE id = 'f-high-010';
UPDATE findings SET fixed_at = '2026-02-07T10:00:00Z' WHERE id = 'f-high-011';
UPDATE findings SET fixed_at = '2026-02-08T14:00:00Z' WHERE id = 'f-med-016';
